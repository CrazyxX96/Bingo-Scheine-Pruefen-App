<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Bingoscheine PrÃ¼fen</title>
<meta name="color-scheme" content="light dark" />
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.0/dist/tesseract.min.js" crossorigin="anonymous"></script>
<style>
  :root{--bg:#f7f7f8;--card:#ffffff;--text:#111;--muted:#6b7280;--line:#e5e7eb;--accent:#111;--radius:16px;--hit:#ffff00;--status-neutral:#f3f4f6;--status-neutral-border:#e5e7eb;--status-win:#fff7ae;--status-win-border:#f1e58f;--error:#ef4444;--mini-cell:44px;--mini-head:36px;--handle:#00BCD4;--space-xs:8px;--title-size:24px;--bingo-green:#8BC34A;--title-blue:#2F55A4}
  @media (prefers-color-scheme: dark){:root{--bg:#0b0c0f;--card:#121419;--text:#f3f4f6;--muted:#9aa0a6;--line:#22252b;--accent:#fafafa;--status-neutral:#1f2937;--status-neutral-border:#374151;--status-win:#3a3400;--status-win-border:#5a5200}}
  @media (max-width:480px){:root{--mini-cell:36px;--mini-head:30px;--title-size:22px}}
  *{box-sizing:border-box}
  .stack-xs>*+*{margin-top:var(--space-xs)}
  .spacer{height:var(--space-xs)}
  .grid.headless{margin-top:0!important}
  body{margin:0;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .app{min-height:100dvh;background:var(--bg);padding-bottom:84px}
  header{position:sticky;top:0;background:color-mix(in oklab,var(--card) 85%,transparent);backdrop-filter:saturate(1.2) blur(8px);border-bottom:1px solid var(--line);z-index:10}
  .wrap{max-width:1000px;margin:0 auto;padding:16px;text-align:center}
  h1{margin:0;font-size:20px;color:var(--text)}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 4px 18px rgba(0,0,0,.06)}
  .card .inner{padding:16px}
  .subtitle{color:var(--muted);margin-top:2px;font-size:14px}
  .card .inner h2,.card .inner h3,.title-row h2,.title-row h3{font-size:var(--title-size);line-height:1.25;margin:0 0 6px 0;text-decoration:underline;text-underline-offset:4px;text-decoration-thickness:2px}
  .grid{display:grid;grid-template-columns:repeat(5,1fr)}
  .grid .head{text-align:center;font-weight:700;color:#fff;background:var(--accent);padding:10px 0}
  .grid .cell{border-right:1px solid var(--line);border-bottom:1px solid var(--line)}
  .grid .cell:nth-child(5n){border-right:0}
  .grid input{width:100%;height:48px;border:0;text-align:center;font-weight:600;font-size:18px;background:transparent;color:var(--text);outline:none}
  .grid input.invalid{border:2px solid var(--error);border-radius:10px;background:color-mix(in oklab,var(--error) 6%,transparent)}
  .hit{background:var(--hit)}
  .mini-head{grid-column:1/6;display:grid;grid-template-columns:repeat(5,1fr)}
  .mini-head span{background:var(--accent);color:#fff;font-weight:700;height:var(--mini-head);display:flex;align-items:center;justify-content:center}
  .board-mini{position:relative;display:grid;grid-template-columns:repeat(5,1fr);grid-auto-rows:var(--mini-cell);border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .board-mini div{display:flex;align-items:center;justify-content:center;border-right:1px solid var(--line);border-bottom:1px solid var(--line);font-weight:600}
  .board-mini div:nth-child(5n){border-right:0}
  .win-lines{position:absolute;inset:0;pointer-events:none}
  .picker{display:grid;grid-template-columns:repeat(5,1fr)}
  .picker .head{text-align:center;font-weight:700;color:#fff;background:var(--accent);padding:10px 0}
  .picker .num{border-right:1px solid var(--line);border-bottom:1px solid var(--line);padding:10px 0;text-align:center;cursor:pointer}
  .picker .num:nth-child(5n){border-right:0}
  .picker .num.selected{background:var(--hit)}
  .form{display:grid;gap:12px;grid-template-columns:repeat(2,minmax(0,1fr));margin-top:16px}
  .field{display:grid;gap:6px}
  .label{font-size:14px;color:var(--muted)}
  .input{height:42px;border:1px solid var(--line);background:transparent;color:var(--text);border-radius:10px;padding:0 12px;outline:none;text-align:center}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;justify-content:center}
  .row.center{justify-content:center}
  .btn{appearance:none;border:1px solid var(--line);background:var(--card);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;display:inline-flex;gap:8px;align-items:center;justify-content:center}
  .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
  .badge{background:#ef4444;color:#fff;border-radius:999px;padding:2px 8px;font-size:12px;font-weight:700}
  .tabs{position:fixed;left:0;right:0;bottom:0;border-top:1px solid var(--line);background:color-mix(in oklab,var(--card) 90%,transparent);backdrop-filter:saturate(1.2) blur(8px);z-index:20}
  .tabs ul{list-style:none;margin:0 auto;padding:0;display:grid;grid-template-columns:repeat(4,1fr);max-width:620px}
  .tabs button{width:100%;padding:12px 0;background:none;border:0;color:#999;display:flex;align-items:center;justify-content:center;gap:8px}
  .tabs .active{color:var(--text);position:relative}
  .tabs .active::before{content:"";position:absolute;top:-2px;width:34px;height:4px;background:var(--accent);border-radius:999px}
  .tab-label{display:none}
  @media(min-width:480px){.tab-label{display:inline}}
  .page{display:none;animation:fade .2s ease-out}
  .page.active{display:block}
  @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  .grid-tiles{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;align-items:stretch;justify-items:stretch}
  .grid-tiles .card{height:100%;margin-top:0;width:100%}
  .grid-tiles .card .inner{display:flex;flex-direction:column;height:100%}
  .ticket-actions{margin-top:auto;display:flex;gap:10px;justify-content:center}
  .title-row{display:flex;align-items:center;justify-content:center;gap:12px}
  .muted{color:#6b7280}
  .status{border:1px solid var(--status-neutral-border);background:var(--status-neutral);border-radius:12px;padding:12px;text-align:center}
  .status.win{border-color:var(--status-win-border);background:var(--status-win)}
  .status .title{font-weight:800}
  .counterbar{display:block;width:100%;padding:10px 12px;margin:0;background:var(--status-neutral);border:1px solid var(--status-neutral-border);border-radius:12px;text-align:center;font-weight:600}
  .page>.card+.card{margin-top:12px}
  .card.tiny{display:table;margin:12px auto}
  .card.tiny .inner{padding:6px 12px}
  .spaced>*+*{margin-top:12px}
  .empty-center{grid-column:1/-1;display:flex;justify-content:center;margin:12px auto}
  .date-line{min-height:20px}
  .badge-row{height:32px;display:flex;align-items:center;justify-content:center;margin-top:6px}
  .badge-row .badge{display:inline-block}
  .photo-bar{display:grid;grid-template-columns:1fr;gap:8px;align-items:start;justify-items:center;text-align:center}
  .photo-actions{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .photo-zoom-controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .hint{font-size:13px;color:var(--muted);text-align:center;max-width:520px;margin:0 auto}
  #photoStage{position:relative;max-width:100%;width:100%;aspect-ratio:4/3;background:#fafafa;border:1px dashed #bbb;border-radius:12px;overflow:hidden;user-select:none;-webkit-user-select:none;touch-action:none;margin-top:10px}
  #photoImage{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;pointer-events:none;transform-origin:center center;cursor:grab}
  #photoImage.dragging{cursor:grabbing}
  .crop-overlay{position:absolute;inset:0;pointer-events:none}
  .crop-rect{position:absolute;border:3px solid var(--handle);box-shadow:0 0 0 9999px rgba(0,0,0,.35);pointer-events:auto;cursor:move;transform-origin:center center;touch-action:none;z-index:5}
  .grid-line{position:absolute;background:rgba(255,255,255,.9)}
  .handle{position:absolute;width:28px;height:28px;background:var(--handle);border:2px solid #fff;border-radius:50%;box-shadow:0 1px 4px rgba(0,0,0,.4);cursor:grab;touch-action:none;z-index:6}
  .handle.tl{left:0;top:0;transform:translate(-50%,-50%)}
  .handle.tr{left:100%;top:0;transform:translate(50%,-50%)}
  .handle.bl{left:0;top:100%;transform:translate(-50%,50%)}
  .handle.br{left:100%;top:100%;transform:translate(50%,50%)}
  .ocr-guides{position:absolute;inset:0;pointer-events:none}
  .ocr-guide-cell{position:absolute;border:2px dashed color-mix(in oklab,var(--handle) 80%,#fff 0%);background:color-mix(in oklab,var(--handle) 10%,transparent);border-radius:6px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.25)}
  .d-none{display:none!important}
  .no-scroll{overflow:hidden}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:saturate(1.2) blur(4px);display:flex;align-items:center;justify-content:center;z-index:9999}
  .overlay-box{background:var(--card);color:var(--text);border:1px solid var(--line);border-radius:16px;padding:20px 24px;width:min(520px,92vw);text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .overlay-title{margin:0 0 8px 0;font-weight:800}
  .overlay-subtitle{margin:6px 0 0 0;color:var(--muted)}
  .spinner{width:28px;height:28px;border:3px solid var(--line);border-top-color:var(--accent);border-radius:50%;margin:0 auto 12px;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .progress{width:100%;margin:8px auto 0;padding:4px;border-radius:10px;border:1px solid var(--line);background:var(--status-neutral);position:relative;overflow:hidden}
  .progress-bar{height:14px;border-radius:8px;width:0%;background:linear-gradient(90deg,var(--accent) 0%,color-mix(in oklab,var(--accent) 70%,#fff) 100%)}
  .progress-label{margin-top:6px;font-size:12px;font-weight:600}
  .modal-actions{display:flex;gap:8px;justify-content:center;margin-top:16px}
  #appModalCancel{display:none}
  .grid .head,.mini-head span,.picker .head{background:var(--bingo-green)!important;color:#fff!important}
  .card .inner>h2,.card .inner>h3{text-decoration:none;display:block;margin:-16px -16px 8px -16px;padding:10px 16px;background:var(--title-blue);color:#fff;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
  .card .inner>.title-row{margin:-16px -16px 8px -16px;padding:10px 16px;background:var(--title-blue);color:#fff;border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
  .card .inner>.title-row h2,.card .inner>.title-row h3{margin:0;text-decoration:none;color:#fff}
  .card .inner h2+.subtitle,.card .inner h3+.subtitle,.card .inner .title-row+.subtitle{margin-top:6px}
  #perspOverlay{position:absolute;inset:0;display:grid;grid-template-rows:1fr auto;background:transparent;pointer-events:auto}
  .persp-quad{position:relative;pointer-events:auto}
  .persp-handle{position:absolute;width:22px;height:22px;border:2px solid #fff;border-radius:50%;background:var(--handle);box-shadow:0 1px 4px rgba(0,0,0,.35);transform:translate(-50%,-50%);cursor:grab;pointer-events:auto;touch-action:none;z-index:7}
  .persp-lines{position:absolute;inset:0;z-index:6;pointer-events:none}
  .persp-toolbar{display:flex;gap:8px;justify-content:center;align-items:center;padding:8px;background:color-mix(in oklab,var(--card) 85%,transparent);border-top:1px solid var(--line);pointer-events:auto}
</style>
</head>
<body>
<div class="app">
  <header><div class="wrap"><h1>Bingoscheine PrÃ¼fen</h1></div></header>
  <main class="wrap" id="pages">
    <section class="page active" id="page-schein">
      <div class="card"><div class="inner"><div id="ticket-count-bar-small" class="counterbar"></div></div></div>
      <div class="card"><div class="inner">
        <h2>Foto importieren</h2>
        <div class="spacer"></div>
        <div class="spacer"></div>
        <div class="spacer"></div>
        <div class="photo-bar">
          <div class="stack-xs">
            <input type="file" id="ocrFile" accept="image/*">
            <div class="photo-actions">
              <button class="btn d-none" id="perspBtn">ğŸ“· Fotoperspektive Ã¤ndern</button>
              <button class="btn d-none" id="perspCancelTop">âŒ Abbrechen</button>
              <button class="btn d-none" id="alignBtn">ğŸ“ Zahlenerkennung ausrichten</button>
              <button class="btn d-none" id="alignCancelTop">âŒ Abbrechen</button>
              <button class="btn d-none" id="removePhotoBtn">ğŸ—‘ï¸ Foto LÃ¶schen</button>
            </div>
            <div class="photo-zoom-controls">
              <button class="btn d-none" id="zoomInBtn">ğŸ” +</button>
              <button class="btn d-none" id="zoomOutBtn">ğŸ” âˆ’</button>
              <button class="btn d-none" id="zoomResetBtn">âŸ² Reset</button>
            </div>
            <div class="hint d-none" id="photoHint">â„¹ï¸ <strong>Tipp:</strong> Nutze zuerst â€Fotoperspektive Ã¤ndernâ€œ, um das Foto zu entzerren. Danach â€Zahlenerkennung ausrichtenâ€œ.</div>
          </div>
        </div>
        <div id="photoStage" class="d-none">
          <img id="photoImage" alt="Bingoschein">
          <div id="perspOverlay" class="d-none">
            <div id="perspQuad" class="persp-quad">
              <div class="persp-handle" data-corner="tl" title="Oben links"></div>
              <div class="persp-handle" data-corner="tr" title="Oben rechts"></div>
              <div class="persp-handle" data-corner="br" title="Unten rechts"></div>
              <div class="persp-handle" data-corner="bl" title="Unten links"></div>
              <svg class="persp-lines" aria-hidden="true"></svg>
            </div>
            <div class="persp-toolbar"></div>
          </div>
          <div class="crop-overlay d-none" id="cropOverlay">
            <div id="cropRect" class="crop-rect" style="left:10%; top:10%; width:80%; height:80%;">
              <div class="grid-line" data-g="v1"></div><div class="grid-line" data-g="v2"></div><div class="grid-line" data-g="v3"></div><div class="grid-line" data-g="v4"></div>
              <div class="grid-line" data-g="h1"></div><div class="grid-line" data-g="h2"></div><div class="grid-line" data-g="h3"></div><div class="grid-line" data-g="h4"></div>
              <div id="ocrGuides" class="ocr-guides" aria-hidden="true"></div>
              <div class="handle tl" data-h="tl"></div>
              <div class="handle tr" data-h="tr"></div>
              <div class="handle bl" data-h="bl"></div>
              <div class="handle br" data-h="br"></div>
            </div>
          </div>
        </div>
        <div id="ocrStatus" class="subtitle" style="margin-top:8px"></div>
      </div></div>
      <div class="card" id="createCard"><div class="inner">
        <div class="title-row"><h2>Schein erstellen</h2></div>
        <div class="spacer"></div>
        <div class="grid" style="margin-top:12px"><div class="head">B</div><div class="head">I</div><div class="head">N</div><div class="head">G</div><div class="head">O</div></div>
        <div id="board" class="grid" style="border:1px solid var(--line);border-top:0;border-radius:0 0 var(--radius) var(--radius);overflow:hidden"></div>
        <div class="form">
          <div class="field"><label class="label" for="name">Scheinname</label><input class="input" id="name" placeholder="z.B. Schein 1"></div>
          <div class="field"><label class="label" for="datum">Datum</label><input class="input" id="datum" type="date"></div>
          <div class="field"><label class="label" for="serien">Seriennummer</label><input class="input" id="serien"></div>
          <div class="field"><label class="label" for="los">Losnummer</label><input class="input" id="los"></div>
        </div>
        <p class="subtitle" id="editInfo" style="display:none;color:#2563eb">Bearbeitungsmodus aktiv â€“ â€Schein speichernâ€œ Ã¼berschreibt den ausgewÃ¤hlten Schein.<button class="btn" id="cancelEdit" style="margin-left:8px">âŒ Abbrechen</button></p>
        <div class="row center">
          <button class="btn primary" id="saveTicket">ğŸ’¾ Schein speichern</button>
          <button class="btn" id="resetBoard">ğŸ—‘ï¸ Bereich zurÃ¼cksetzen</button>
          <button class="btn" id="fillRandom">ğŸ² ZufÃ¤llig fÃ¼llen</button>
        </div>
      </div></div>
    </section>
    <section class="page" id="page-saved">
      <div class="card"><div class="inner"><div id="ticket-count-bar-big" class="counterbar"></div></div></div>
      <div class="card"><div class="inner">
        <div class="title-row"><h2>Gespeicherte Scheine</h2></div>
        <div class="stack-xs">
          <p class="subtitle">â„¹ï¸Zahlen, die als â€gezogenâ€œ hinzugefÃ¼gt wurden, erscheinen gelb hinterlegt. BINGO-Linien werden rot Ã¼berzogen.</p>
          <div class="row center"><button class="btn" id="clearTickets">ğŸ—‘ï¸ Alle Scheine lÃ¶schen</button></div>
          <div class="spacer"></div>
          <div id="tickets" class="grid-tiles"></div>
        </div>
      </div></div>
    </section>
    <section class="page" id="page-draw">
      <div class="card"><div class="inner"><div id="draw-count-bar" class="counterbar"></div></div></div>
      <div class="card"><div class="inner">
        <div class="title-row"><h2>Gezogene Zahlen eintragen</h2></div>
        <p class="subtitle">â„¹ï¸Tipp: Mehrere Zahlen mit Komma oder Leerzeichen trennen. GÃ¼ltig sind Zahlen von 1â€“75. Doppelte Zahlen werden ignoriert.</p>
        <div class="row center">
          <input class="input" id="drawInput" placeholder="z.B. 1, 6, 7, 14" inputmode="numeric">
          <button class="btn primary" id="addDrawn">â• HinzufÃ¼gen</button>
        </div>
      </div></div>
      <div class="card tiny"><div class="inner" style="text-align:center"><strong>Oder</strong></div></div>
      <div class="card"><div class="inner">
  <div class="title-row"><h3>Gezogene Zahlen auswÃ¤hlen</h3></div>

  <div class="row center">
    <button class="btn" id="clearDrawnOverview">ğŸ—‘ï¸ Alle Zahlen lÃ¶schen</button>
  </div>

  <div class="spacer"></div>

  <div class="picker" id="pickerHeader">
    <div class="head">B</div><div class="head">I</div><div class="head">N</div>
    <div class="head">G</div><div class="head">O</div>
  </div>
  <div class="picker" id="pickerGrid" style="border:1px solid var(--line);border-top:0;border-radius:0 0 var(--radius) var(--radius);overflow:hidden"></div>
</div></div>

    </section>
    <section class="page" id="page-overview">
      <div class="card"><div class="inner">
        <div class="title-row"><h3>Gezogene Zahlen</h3></div>
        <div class="stack-xs">
          <div class="row center"><button class="btn" id="clearDrawnOverview">ğŸ—‘ï¸ Alle Zahlen lÃ¶schen</button></div>
          <div class="spacer"></div>
          <div class="grid headless"><div class="head">B</div><div class="head">I</div><div class="head">N</div><div class="head">G</div><div class="head">O</div></div>
          <div id="overviewTable" class="grid" style="border:1px solid var(--line);border-top:0;border-radius:0 0 var(--radius) var(--radius);overflow:hidden"></div>
        </div>
      </div></div>
      <div class="card" id="statusCard"><div class="inner spaced">
        <h2>Bingo-Ergebnisse</h2>
        <div id="overview-count-tickets" class="counterbar"></div>
        <div id="overview-count-status" class="counterbar"></div>
        <div id="statusBox" class="status"><div class="title" id="statusTitle">Noch kein Bingo</div><div class="sub" id="statusSub"></div></div>
      </div></div>
      <div class="card" id="winnersCard"><div class="inner">
        <div class="title-row"><h3>Gewonnene Scheine</h3></div>
        <p class="subtitle" id="winnersSubtitle">Kein Schein mit Gewinn vorhanden</p>
        <div id="winnersList" class="grid-tiles"></div>
      </div></div>
    </section>
  </main>
  <nav class="tabs" aria-label="Hauptnavigation">
    <ul>
      <li><button data-target="page-schein" class="active">âœï¸ <span class="tab-label">Erstellung</span></button></li>
      <li><button data-target="page-saved">ğŸ“„ <span class="tab-label">Scheine</span></button></li>
      <li><button data-target="page-draw">ğŸ² <span class="tab-label">Zahlen</span></button></li>
      <li><button data-target="page-overview">ğŸ“Š <span class="tab-label">Ãœbersicht</span></button></li>
    </ul>
  </nav>
</div>
<div id="ocrOverlay" class="overlay d-none" role="dialog" aria-modal="true" aria-labelledby="ocrOverlayTitle" aria-describedby="ocrOverlayStatus">
  <div class="overlay-box">
    <div class="spinner" aria-hidden="true"></div>
    <h3 id="ocrOverlayTitle" class="overlay-title">Erkennung lÃ¤uftâ€¦</h3>
    <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Fortschritt"><div id="ocrOLBar" class="progress-bar"></div></div>
    <div id="ocrOLLabel" class="progress-label" aria-live="polite">0%</div>
    <p id="ocrOverlayStatus" class="overlay-subtitle">Bitte wartenâ€¦</p>
  </div>
</div>
<div id="appModal" class="overlay d-none" role="dialog" aria-modal="true" aria-labelledby="appModalTitle" aria-describedby="appModalMsg">
  <div class="overlay-box">
    <h3 id="appModalTitle" class="overlay-title">Hinweis</h3>
    <p id="appModalMsg" class="overlay-subtitle" style="margin-top:8px"></p>
    <div class="modal-actions"><button class="btn" id="appModalCancel">âŒ Abbrechen</button><button class="btn primary" id="appModalOk">OK</button></div>
  </div>
</div>
<script>
